<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Teste de Editor de Texto</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/theme/material-darker.css">

</head>

<body>
    <main>
        <h1>Gerenciador de Projetos</h1>
        <div id="projetos-container">
            <div id="projetosBar">
                <h2>Área de projetos</h2>
                <button id="addProjectButton">Adicionar projeto</button>
            </div>
            <div id="projetosArea"></div>
        </div>
    </main>
    <div id="overlay"></div>
    <div id="projetoDesc">
        <h2>Informações do Projeto</h2>
        <form id="projectForm">
            <p>Digite o nome do projeto:</p>
            <input type="text" id="projectName" placeholder="Digite o nome" required>
            <input type="reset" value="Cancelar" id="cancelProject"><input type="submit" value="Criar"
                id="createProject">
        </form>
    </div>
    <div id="projectEditorSpace">
        <div id="projectEditorBar">
            <h2 id="projectEditorTitle">Projeto em edição: </h2>
            <button id="addFileButton">Adicionar</button>
        </div>
        <div id="projectEditorStatusContainer">
            <div id="projectEditorStatus">
                <h2 id="projectEditorStatusTitle">Explorador</h2>
                <div id="projectEditorStatusArea"></div>
            </div>
            <div id="projectEditorDownload">
                <h2 id="projectEditorDownloadTitle">Baixe seu projeto</h2>
                <button id="downloadProject">Baixar projeto</button>
            </div>
        </div>
    </div>
    <button id="backToProjectsArea">Voltar para Área de projetos</button>
    <div id="fileMaker">
        <h2>Criador de Arquivos</h2>
        <form id="fileMakerForm">
            <p>Digite o nome do arquivo:</p>
            <input type="text" id="fileName" placeholder="Digite o nome" required>
            <p>Selecione o tipo do arquivo</p>
            <select id="fileType">
                <option value="diretorio">Diretório</option>
                <option value="txt" selected>Texto (padrão)</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="js">Javascript</option>
                <option value="py">Python</option>
            </select>
            <input type="reset" value="Cancelar" id="cancelFile"><input type="submit" value="Criar" id="createFile">
        </form>
    </div>
    <div id="fileEditor">
        <h2>Editor de Arquivos</h2>
        <form id="fileEditorForm">
            <p>Nome do arquivo:</p>
            <input type="text" id="fileEditorName" placeholder="Digite o nome aqui" required>
            <p>Edite o conteúdo do arquivo:</p>
            <textarea id="fileContentEditor" rows="15" placeholder="Digite o texto aqui"></textarea>
            <input type="reset" value="Cancelar" id="cancelEdition"><input type="submit" value="Editar"
                id="editEdition">
        </form>
    </div>

    <script src="js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/xml/xml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/javascript/javascript.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/css/css.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/htmlmixed/htmlmixed.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/python/python.js"></script>

    <!-- Biblioteca geradora de zip-->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>


    <script>
        const editor = CodeMirror.fromTextArea(document.getElementById("fileContentEditor"), {
            lineNumbers: true,
            mode: "htmlmixed",
            theme: "material-darker",
            tabSize: 4,
            indentWithTabs: true
        })
        function checkChange() {
            let type = ""
            let mode = ""
            JSON.parse(localStorage.getItem("projetos")).forEach(elemento => {
                if (elemento.name == localStorage.getItem("projeto")) {
                    elemento.arquivos.forEach(arquivo => {
                        if (arquivo.name == localStorage.getItem("arquivo")) {
                            type = arquivo.type
                        }
                    })
                }
            })
            if (type == "py") {
                mode = "python"
            } else if (type == "html") {
                mode = "htmlmixed"
            } else if (type == "css") {
                mode = "css"
            } else if (type == "js") {
                mode = "javascript"
            } else if (type == "diretorio") {
                mode = "htmlmixed"
            } else if (type == "txt") {
                mode = "htmlmixed"
            }
            return mode
        }
        const zip = new JSZip()

        downloadProject.addEventListener("click", async () => {
            Object.keys(zip.files).forEach(key => {
                zip.remove(key)
            })
            JSON.parse(localStorage.getItem("projetos")).forEach(elemento => {
                if (elemento.name == localStorage.getItem("projeto")) {
                    elemento.arquivos.forEach(arquivo => {
                        if (arquivo.type != "diretorio") {
                            zip.file(`${arquivo.name}.${arquivo.type}`, arquivo.content)
                        }
                    })
                }
            })

            const blob = await zip.generateAsync({type: "blob"})
            const link = document.createElement("a")
            link.href = URL.createObjectURL(blob)
            link.download = `${localStorage.getItem("projeto")}.zip`
            link.click()

            URL.revokeObjectURL(link.href)

        })

    </script>
</body>

</html>